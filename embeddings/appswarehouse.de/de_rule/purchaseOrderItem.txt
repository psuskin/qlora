Dies ist die Beschreibung des Moduls "purchaseOrderItem" mit dem Namen "Bestellposition": Allgemein Rahmenbestellung (Abrufbestellung) Nachträgliche Verbindung BA <--> BE Bestelltyp: Nachträgliche Verbindung Auftragsposition -> Liefereinteilung (Anforderer Kundenbedarf) Ermittlung der Preise Berechnung der preislichen Konditionen Bestellpositionspreis als ein lieferantenspezifischen Preis übernehmen Bestelltext-Feld Bestellnummer. Dies ist die Beschreibung der Funktionalität des Moduls "purchaseOrderItem" mit dem Namen "Bestellposition" bezüglich Allgemein: Auf einer Bestellposition werden ein zu bestellendes Teil und entsprechende Bestelldaten und -konditionen erfasst. Bestellposition besteht grundsätzlich aus einer oder mehreren Liefereinteilungen; Angaben wie Menge, Termin und andere werden ausschließlich auf einzelnen Liefereinteilungen gemacht. Ist für die Bestellposition eine Beistellung nötig, so wird ein Hinweis neben dem Bestelltyp angezeigt: ACHTUNG: BEISTELLUNG. Neben diesem Hinweis erscheint ein Knopf "Beistellungen", welcher die anhängenden Beistellungen öffnet. Dies ist die Beschreibung der Funktionalität des Moduls "purchaseOrderItem" mit dem Namen "Bestellposition" bezüglich Rahmenbestellung (Abrufbestellung): Eine Bestellposition kann für den nachträglichen Abruf (Rahmenbestellung) konfiguriert werden:. Dies ist die Beschreibung der Funktionalität des Moduls "purchaseOrderItem" mit dem Namen "Bestellposition" bezüglich Bestelltext-Feld, Notiz für Lieferant bzw. Empfänger: Bei Rahmenbestellungen ist das Bestelltext-Feld gesperrt. Dies geschieht, weil beim Erweitern geprüft wird, ob die Beschreibung der Rahmenbestellung und die des einzufügenden Teiles oder der einzufügenden Bedarfsanforderung gleich sind. Ist dies nicht der Fall, so wird die Rahmenbestellung nicht erweitert, weil sonst die Beschreibung aus der Bedarfsanforderung nicht übernommen würde. Falls man selber z.B. dem Lieferanten oder dem Empfänger etwas mitteilen möchte, so gibt es hier die Felder Notiz für Lieferant und Notiz für Empfänger, die Ansicht wird durch den entsprechenden Knopf umgeschaltet. Diese Felder sollen besonders dann benutzt werden, wenn der eigentlich Bestelltext eines Teils aus dem Teilestamm, also nicht z.B. ein Textartikel, nicht ausreichend ist bzw. aus besonderem Grund noch ergänzt werden muss! Wenn der eigentliche Bestelltext nie ausreichend ist bzw. immer durch einen gleichen Zusatz zu ergänzen ist, dann sollte dieser selber schon im Stamm bzw. der Lieferantenvereinbarung korrigiert werden. Wenn Sie jetzt im System eine offene Rahmenbestellung haben und im Bestellartikel den Bestelltext ändern wollen, dann erhalten Sie eine Warnmeldung im Bestellartikel die eben diese Differenz erklärt und fragt, ob der jetzt geänderte Bestelltext im Bestellartikel auf die Rahmenbestellung übernommen werden soll! Dies ist die Beschreibung der Funktionalität des Moduls "purchaseOrderItem" mit dem Namen "Bestellposition" bezüglich Nachträglich eine offene Bedarfsanforderungsposition mit einer offenen Liefereinteilung verbinden: Sollten im System eine Bedarfsanforderungsposition und eine Liefereinteilung von einer Bestellposition einzeln angelegt werden, wobei sie beide zu einem Geschäftsvorfall gehören, dann können solche zwei Positionen in eine Belegkette verbunden werden: die Bedarfsanforderungsposition soll per Drag&Drop auf die Liefereinteilung gezogen werden. Voraussetzungen: - es darf genau eine Bedarfsanforderungsposition reingezogen werden - die Liefereinteilung darf keinen Vorgänger-Beleg besitzen - die Bedarfsanforderungsposition soll offen sein (noch nicht komplett bestellt) - Teile auf der Bedarfsanforderungsposition und Bestellposition sollen gleich sein. Dies ist die Beschreibung der Funktionalität des Moduls "purchaseOrderItem" mit dem Namen "Bestellposition" bezüglich Nachträgliche Verbindung Auftragsposition -> Liefereinteilung (Anforderer: Kundenbedarf): Es gibt vier mögliche Verbindungsarten zwischen Auftragspositionen und Liefereinteilungen:. Dies ist die Beschreibung der Funktionalität des Moduls "purchaseOrderItem" mit dem Namen "Bestellposition" bezüglich Ermittlung der Preise: Die Vorgehensweise der Preisermittlung bei Bestellpositionen sieht wie folgt aus. Der zuerst gefundene Preis wird in die Bestellung gezogen: (Makro GetItemSupplier in purcoedt.mod holt Lieferanten, puroiedt holt zum Lieferanten passenden Preis) 1. Preisvereinbarungen des dem im Bestellkopf ausgewählten Einkaufsvertrag 1a.) Projektpreis (an das Projekt des Vorgängers gekoppelte Einkaufskostenträger) 1b.) Allgemein gültige Preisvereinbarung über ein Einkaufsvertrag 2. Liefervereinbarungen des A-Lieferanten 3. Letzter Preis des Teils bei letztem Lieferanten 4. Erste gefundene Liefervereinbarung des Bestellartikels 5. Preis aus Bestellartikelrolle (Standardpreis) 6. Preis aus Bedarfsanforderungsposition Wird durch einen dieser Schritte der Preis 0 gezogen, so wird der Preis aus der Bedarfsanforderungsposition, bzw. dem Auftragsvorgänger übernommen. Der zuletzt benutzte Preis wird bei dem ausgewählten Lieferanten in seinen Bewegungsmonitoren gespeichert. Dazu werden alle Rabatte und Zuschläge berücksichtigt. Die Preise aus den Bestellungen werden in folgenden Bereichen weiterverarbeitet: 1. Wareneingang 2. Durchschnittspreisberechnung 3. Lagerstatistik (Bestimmung des Lagerwertes) Der Wareneingang gibt den von der Bestellung erhaltenen Preis an die anderen Bereichen weiter. Erneutes Ermitteln des Preises Wenn die Bestellposition nur aus einer Liefereinteilung besteht, wird bei jedem Speichern der Preis neu ermittelt und überprüft ob er sich geändert hat (z.B. manuelle Eingabe). Besteht die Bestellung aber aus mehreren Liefereinteilungen so wird erst nach Speichern der bearbeiteten Liefereinteilung der Preis neu ermittelt. Das geschieht so, weil sich der Preis oft erst ändert, wenn die Stückzahl in der Liefereinteilung verändert wird. Falls die Ausprägung der Attribute verändert wird, so wird der Preis jedes mal neu ermittelt. Dies ist die Beschreibung der Funktionalität des Moduls "purchaseOrderItem" mit dem Namen "Bestellposition" bezüglich Berechnung der preislichen Konditionen auf Bestellpositionen und Liefereinteilungen: Es gibt zwei Möglichkeiten, Bestellpositionen mit Konditionen zu versehen. 1- man speichert die Konditionen direkt in die Bestellposition. Dann wird die Kondition nach Ermittlung der Liefereinteilungspreise auf das Ergebnis aufgerechnet. 2- man speichert die Konditionen in die Liefereinteilung selbst. So lassen sich pro Liefereinteilung gültige Konditionen abspeichern, die keinen Einfluss auf andere Liefereinteilungen haben. Das Ergebnis der folgenden Umrechnungen wird im Slot gross.value gespeichert. Dieser wird dann für die Weiterverarbeitung in den Wareneingängen und Durchschnittswertberechnung benutzt. Absolute Konditionen: Zu beachten ist außerdem, dass sich auch absolute Konditionen (-100€) auf den Einzelpreis auswirken. Er wird also, wie auch alle anderen Konditionen in den Positionen, mit der für die Position gespeicherten Menge multipliziert. Ermittlung der Preise der einzelnen Liefereinteilungen bei absoluten Zu-/Abschlägen (z.B. in Bestellstatus Liste und Berechnung der Werte in Durchschnittswertberechung und Lagerwertberechnung): Daten, die in Liefereinteilungen festgelegt wurden, sind gelb dargestellt. Daten, die in Bestellpositionen festgelegt wurden, sind blau dargestellt. Daten, die im Bestellkopf festgelegt wurden, sind grün dargestellt. Konditionen, die aus übergeordneten Datensätzen stammen und aufgeteilt wurden, sind kursiv dargestellt. Definitionen der Slots: total.value: In total.value werden die Werte aus der aktuellen Position incl. Konditionen und allen ihr untergeordneten Positionen gespeichert. Dieser Wert wird auf der jeweiligen Position als Positionswert angezeigt. Beispiel: Liefereinteilung 100€ + 10€ Zuschlag auf Liefereinteilung = total.value 110€ Bestellposition: 1. Liefereinteilung (total.value) 110€ + 10€ Zuschlag auf Bestellposition = total.value 120€ gross.value: In gross.value werden außer allen aktuellen und untergeordneten Positionswerten ebenfalls die aus dem Kopf aufgeteilten Konditionen hinzugerechnet. Dieser Wert ist der tatsächliche Wert der Position. Er ist genauer als der net.value im Auftragsbereich, da hier auch die Kopfkonditionen, die auch den Positionspreis beeinflussen, mit eingerechnet sind. Dieser Preis ist Grundlage für alle folgenden Berechnungen und Anzeigeformulare, in denen der wirkliche Positionswert angezeigt oder verarbeitet werden muss (Durchschnittswertermittlung, Lagerbewertung etc.) Auf den Positionen ist dieser Wert nicht sichtbar. Beispiel: Zuschlag von 100€ im Bestellkopf. Liefereinteilung : total.value = 110€, gross.value = 210€ Bestellposition : total.value = 120€, gross.value = 220€ In diesem Beispiel wurde die Kondition des Kopfes auf die einzige Liefereinteilung "verteilt", sie erhält daher den vollen Zuschlag von 100€. (Aufteil-Logik ist nachfolgend und in den Tabellen beschrieben) Die Aufteilung der Konditionen von den Bestellpositionen auf die Liefereinteilungen erfolgt anteilig durch die in den Liefereinteilungen angegebenen Mengen zur Gesamtmenge der Bestellposition. Weitere Beispiele sind in dieser Excel Datei aufgeführt. Konditionen aus dem Bestellkopf werden anteilig anhand des preislichen Volumens der Bestellpositionen aufgeteilt. Zur Ermittlung dieser Preise wird der grau markierte Zwischenpreis genommen. Diese Anteile werden dann wiederum wie Konditionen auf Bestellpositionen auf die Liefereinteilungen aufgeteilt. Erläuterung zur Berechnung der aufzuteilenden Bestellkopfkondition anhand des obigen Beispiels: Gesamtzuschlag auf Bestellkopf: 1000€ 1. Bestellposition: 1000€/14.160€*4.160€ = 293,79€ (Zuschlag/Gesamtvolumen Bestellung*Gesamtvolumen Bestellposition) 1. Liefereinteilung der ersten Bestellposition: 293,79€/40*10 = 73,45€ (Zuschlag/Gesamtmenge Bestellposition*Menge auf Liefereinteilung) 2. Liefereinteilung der ersten Bestellposition: 293,79€/40*30 = 220,34€ (Zuschlag/Gesamtmenge Bestellposition*Menge auf Liefereinteilung) 2. Bestellposition: 1000€/14.160€*10.000€ = 706,21€ 1. Liefereinteilung der zweiten Bestellposition: 706,21€/10.000*10.000=706,21€ Gesamtvolumen des Zuschlages: 706,21€ + 73,45€ + 220,34€ = 1000,00€ Ermittlung des Gesamtpreises der Bestellung (im Bestellpositionsfenster):. Dies ist die Beschreibung der Funktionalität des Moduls "purchaseOrderItem" mit dem Namen "Bestellposition" bezüglich Bestellpositionspreis als ein lieferantenspezifischen Preis übernehmen: Mit dem Toolbar-Knopf wird der Preis von der Bestellposition als ein lieferantenspezifischer Preis auf dem Bestellartikel gespeichert (nur wenn ein Lieferant auf der Bestellung und eine Teile-Bestellrolle vorhanden sind). Hat die Bestellposition kalkulatorische Konditionen (Rabatt, Zuschlag, Fracht u.s.w.), dann wird die Frage gestellt, ob der Preis mit solchen Konditionen oder ohne übernommen werden soll. Wenn ein lieferantenspezifischer Preis für den Bestellartikel bereits existiert und "komplex" ist (d.h. der Preis ist ein komplexer Preis mit mehr als einem Preisglied oder ist als eine bedingte Tabelle oder eine Funktion definiert), dann kann ein solcher Preis nicht überschrieben werden. Dies ist die Beschreibung der Funktionalität des Moduls "purchaseOrderItem" mit dem Namen "Bestellposition" bezüglich Eingabefenster: Dieses Fenster dient der Pflege von Bestellpositionen. Über ‚Teil’ wählen Sie aus der sich öffnenden Bestellartikelliste das entsprechende Teil aus. Anschließend können Sie die Bestellnummer des Lieferanten einfügen und den Bestelltext noch beliebig überarbeiten. Im Feld ‚Liefereinteilung’ über ‚Einfügen’ können Sie die Bestellmenge und Ihren Wunschtermin eingeben. Es ist ebenfalls möglich die Bestellmengen zu teilen und Ihren Wunschtermin für die einzelnen Mengen vorzugeben, z.B. 10 Stück schnellstens, Rest auf Abruf. In den Feldern ‚Bemerkung’ und ‚Empfänger’ können Sie Anmerkungen zu Ihrer Bestellung unterbringen Im unteren Teil der Maske können Sie nun den Preis Ihrer Bestellartikel einsetzen und evtl. zu gewährende Rabatte eintragen. Mit ‚OK’ speichern Sie die Bestellposition ab. Das System vergibt eine Positionsnummer und übernimmt die Position in die Bestellung. Dies ist die Beschreibung der Funktionalität des Moduls "purchaseOrderItem" mit dem Namen "Bestellposition" bezüglich Schnellbestellungsfenster: Dieses Fenster dient der schnellen Erfassung von Bestellpositionen z.B. für einfache Kostenstellenbuchungeno oder für JIT Teileanforderung aus einem Fertigungsauftrag heraus, was dann auch durch die Fertigung selber ausgeführt werden könnte. Eine Bearbeitung der Bestellung über die normale Bestellbearbeitung ist dennoch jederzeit möglich. Bei der Schnellerfassung einer neuen Bestellung wird der angemeldete Mitarbeiter als Bearbeiter der Bestellung vorgeschlagen. Als erstes sollte der Lieferant ausgewählt werden, der die Bestellung erhalten soll. Eine spätere Neubestimmung des Lieferanten ist nur noch über die normale Bestellmaske möglich. Dies ist die Beschreibung der Funktionalität des Moduls "purchaseOrderItem" mit dem Namen "Bestellposition" bezüglich Positionsdaten: Dieses Fenster dient der Pflege der Bestellpositionsdaten. Dies ist die Beschreibung der Funktionalität des Moduls "purchaseOrderItem" mit dem Namen "Bestellposition" bezüglich Gruppierte Positionen: Es gibt die Möglichkeit, über die Bestellstatusliste oder den Bestellkopf über einen Toolbarknopf (Prüfen Preiszusammenfassung) zu prüfen, ob verschiedene Bestellpositionen von gleichen Variantenteilen mit unterschiedlichen Ausprägungen zusammengefasst und somit ein Mengenrabatt aus den Preistabellen herausgeschlagen werden können. Dies ist möglich, wenn die Attribute, die für die Preistabellen der Bestellpreise nötig sind, bei allen diesen eigentlich unterschiedlich ausgeprägten Variantenteilen gleich sind. Die korrigierten Preise können dann nach Einsicht über ein Ergebnisfenster auf die Bestellpositionen übernommen werden. Dies ist die Beschreibung der Funktionalität des Moduls "purchaseOrderItem" mit dem Namen "Bestellposition" bezüglich Ablauf Bestellung erweitern 2 – AppendPurchaseOrderItems: Schnittstellenbeschreibung: CX_PURCHASE_ORDER (Vector, Collection, Object CX_CONTAINER) SendMsg(APPEND_PURCHASE_ORDER_ITEMS) Im Vector befinden sich im Bestellkopf Editiermodul aufbereitete Daten. Die Message APPEND_PURCHASE_ORDER_ITEMS darf nicht einzeln aufgerufen werden. Wenn eine Bestellung um Positionen erweitert werden soll, ist es notwendig, die Message APPEND_PURCHASE_ORDER aufzurufen. AppendPurchaseOrderItems: Die übergebene Bestellung wird in der Variablen purchaseOrder gehalten. Dann werden alle weiteren Objekte durchlaufen: Zuerst werden alle bis hierhin verfügbaren Informationen des anzulegenden Objektes gepluggt (Makro PlugWithPredecessor) und versucht, ein eventuell vorhandenes Variantenteil aufzulösen. Das (un)aufgelöste Teil wird in der Variable orderItem gehalten, mit der im weiteren Verlauf gearbeitet wird. Nun wird in der übergebenen Bestellung eine Bestellposition gesucht, die das gleiche Teil hat (Makro FindPurchaseOrderItem). Wird so eine Position gefunden, wird diese Bestellposition mit EditObject aufgerufen, sonst eine neuen angelegt. Auf dieser Bestellposition wird später eine neue Liefereinteilung angelegt. Hierfür muss erst einmal die zu bestellende Menge ermittelt werden. In einigen Containern, die an das Makro AppendPurchaseOrderItems übergeben wurden, ist bereits eine Menge vorhanden. Diese wird nun aber durch das Makro GetAmountToOrder mit Hilfe der Losgrößen umgerechnet. Ist keine Menge im Container vorhanden gewesen, wird die Standardmenge aus der Bestellartikelrolle gezogen. Aber zuerst wird noch mal kontrolliert, ob es sich bei der gefundenen Bestellposition um eine Rahmenbestellung handelt (Makro CheckCallForwardTransaction). Wenn nicht, werden alle relevanten Daten aus dem Vorgängerbeleg auf die neue Bestellposition übernommen und diese durch SaveObject angelegt/gespeichert. Ist bereits eine Bestellposition mit dem gleichen Teil gefunden worden, werden diese Informationen nicht überschrieben. Ein SaveObject ist nun nicht nötig. Das Makro CreateSubItem, dem der Vorgängerbeleg und die zu bestellende Menge übergeben wird, legt nun eine Liefereinteilung mit der richtigen Menge an und bucht gleich noch den Vorgängerbeleg richtig um. Hier wird auch der Vorgänger mit der neuen Transaktion verbunden. GetBasePurchasePrice: Wenn die Liefereinteilung erstellt ist, kann nach dem zum eventuell eingetragenen Lieferanten passenden Preis gesucht werden. An dieses Makro wird ein TRUE oder ein FALSE übergeben, welches im Makro steuert, woher die benötigten Informationen, die gepluggt werden müssen, genommen werden. Über das Makro FindPurchasePrice wird dann die Liefervereinbarung zwischen Lieferanten und Teil geholt und an das Makro GetPriceOfLogCube übergeben. Gibt das Makro GetPriceOfLogCube keinen oder einen leeren Preis zurück, wird der Standardpreis aus der Bestellartikelrolle genommen und mit Hilfe des Makros AppendToTmpPriceDiscount in der Variable tmpPriceDiscount gehalten. GetPriceOfLogCube: Dieses Makro ermittelt den Preis aus dem übergebenen LogCube. Ist kein Preis vorhanden, oder ist dieser Null, so wird nach dem Preis des letzten Bewegungsmonitor dieses Lieferanten gesucht und dieser wenn gefunden zurückgegeben. AppendToTmpPriceDiscount: Dieses Makro baut anhand eines oder mehreren hintereinander übergebenen Objekte eine gültige Preiskette (CX_PRICE_DISCOUNT mit subCharges) auf. Hierbei werden alle Hauptkettenglieder beibehalten, aber ihre einzelnen subCharges durch einen Aufruf von Amount() aufgelöst. Würden diese ebenfalls übernommen werden, wäre das Endergebnis falsch, da sich die Unterrabatte auf ein Hauptkettenglied bereits auf den Rabatt beziehen und nicht auf den Hauptpreis. Wenn beispielsweise ein Kettenglied so aussieht: +150€-10% dann beziehen sich die –10% auf den Zuschlag 150€ was am Ende +135€ entspricht. Für Nähere Erläuterungen der Preisketten, siehe hier. SaveConditions: Die vorher erstellte Preiskette tmpPriceDiscount wird in Konditionen aufgeteilt. Für jedes Preiskettenglied wird eine Kondition für das Bestellpositionsobjekt angelegt.